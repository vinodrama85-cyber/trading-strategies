//@version=5
indicator("BankNifty Sideways Filter", overlay=true)

// EMAs
ema20 = ta.ema(close, 20)
ema50 = ta.ema(close, 50)
ema100 = ta.ema(close, 100)

// Range check (last 20 candles)
rangeHigh = ta.highest(high, 20)
rangeLow  = ta.lowest(low, 20)
rangePct  = (rangeHigh - rangeLow) / close * 100

// EMA compression
emaCompression = math.abs(ema20 - ema50) < syminfo.mintick * 50 and math.abs(ema50 - ema100) < syminfo.mintick * 50

// Sideways condition
isSideways = rangePct < 0.25 or emaCompression

// Plots
plot(ema20, color=color.yellow)
plot(ema50, color=color.orange)
plot(ema100, color=color.red)

// Background highlight
bgcolor(isSideways ? color.new(color.red, 85) : na)

// Label
if isSideways
    label.new(bar_index, high, "SIDEWAYS\nNO TRADE", style=label.style_label_down, color=color.red, textcolor=color.white)
